################################
#Exprt data for proteomics
################################

#export AAs of all the gene calls
anvi-export-table $WORKDIR/03_contigs/spades_contigs.db --table gene_functions -o $WORKDIR/anvio_output/co-assembly_gene_functions.txt

sed "s/ /_/g" $WORKDIR/anvio_output/co-assembly_gene_functions.txt | grep -i "COG20_FUNCTION" | sort -n -k 1 - > $WORKDIR/anvio_output/co-assembly_gene_functions_sorted.txt

anvi-export-table $WORKDIR/03_contigs/spades_contigs.db --table gene_amino_acid_sequences -o $WORKDIR/anvio_output/co-assembly_gene_calls.txt
sed -n '2,$p' $WORKDIR/anvio_output/co-assembly_gene_calls.txt | sort -n -k 1 > $WORKDIR/anvio_output/co-assembly_gene_calls_sorted.txt

join -j 1 $WORKDIR/anvio_output/co-assembly_gene_functions_sorted.txt $WORKDIR/anvio_output/co-assembly_gene_calls_sorted.txt > $WORKDIR/anvio_output/genes_table_merged.txt


#generate AA fasta file
awk '{print ">"$1"_"$3"_"$4"\n"$6}' $WORKDIR/anvio_output/genes_table_merged.txt > $WORKDIR/anvio_output/genes_aa.fasta
